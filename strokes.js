var pt=Object.defineProperty;var P=(t,e)=>{for(var r in e)pt(t,r,{get:e[r],enumerable:!0})};var Y=t=>{if(typeof t!="string")throw new TypeError("characterString must be a string.");if(t.length!==1)throw new RangeError("Must be a single character.");let e=t.codePointAt(0);if(typeof e>"u")throw new RangeError("Cannot get code point.");return e};var M=new Map,dt=()=>Object.freeze(new Set(M.keys())),Q=t=>{let e=M.get(t);if(typeof e>"u")throw new Error("Unsupported format.");return e},A=t=>{M.set(t.format,t)},Z=t=>{let{animator:e}=Q(t);return(o,i)=>{let{codePoint:s,source:n,strokes:a,transform:c,viewBox:l}=o;return{...e({strokes:a,transform:c,viewBox:l},i),codePoint:s,source:n,format:t}}};var gt=t=>CSS.supports("color",t)&&["currentcolor","inherit","initial","revert","revert-layer","unset"].every(e=>e.localeCompare(t,void 0,{sensitivity:"accent"})!==0),ft=t=>typeof t=="string",j=t=>typeof t=="number",ht=t=>typeof t=="boolean",z=function*(t,e){ht(t)||(yield new TypeError(`${e} is not a boolean.`))},$=function*(t,e){ft(t)||(yield new TypeError(`${e} is not a string.`)),gt(t)||(yield new RangeError(`${e} is not a valid color.`))},D=function*(t,e,r){j(t)||(yield new TypeError(`${e} is not a number.`)),isNaN(t)&&(yield new RangeError(`${e} is NaN.`)),isFinite(t)||(yield new RangeError(`${e} is not finite.`)),j(r?.gt)&&!(t>r.gt)&&(yield new RangeError(`${e} is not > ${r.gt}.`)),j(r?.lt)&&!(t<r.lt)&&(yield new RangeError(`${e} is not < ${r.lt}.`)),j(r?.ge)&&!(t>=r.ge)&&(yield new RangeError(`${e} is not >= ${r.ge}.`)),j(r?.le)&&!(t<=r.le)&&(yield new RangeError(`${e} is not <= ${r.le}.`))},St=t=>{let{includeGrid:e,gridColor:r,gridRows:o,gridColumns:i,includeBackground:s,backgroundColor:n,includePreview:a,previewColor:c,strokeColor:l,pauseRatio:u,totalStrokeDuration:m}=t,d=[...z(e,"includeGrid"),...$(r,"gridColor"),...D(o,"gridRows",{ge:1}),...D(i,"gridColumns",{ge:1}),...z(s,"includeBackground"),...$(n,"backgroundColor"),...z(a,"includePreview"),...$(c,"previewColor"),...$(l,"strokeColor"),...D(u,"pauseRatio",{ge:0,lt:1}),...D(m,"totalStrokeDuration",{gt:0})];if(d.length>0)throw new AggregateError(d,d.map(g=>g.message).join(" "))},_=Object.freeze({includeGrid:!1,gridColor:"#d3d3d3",gridRows:2,gridColumns:2,includeBackground:!1,backgroundColor:"#ffffff",includePreview:!1,previewColor:"#c0c0c0",strokeColor:"#000000",pauseRatio:.2,totalStrokeDuration:1}),tt=t=>{let e={..._,...Object.fromEntries(Object.entries(t??{}).filter(([r,o])=>r in _&&typeof o<"u"&&o!==null))};return St(e),Object.freeze(e)};var L=new Map,kt=()=>Object.freeze(new Set(L.keys())),et=t=>{let e=L.get(t);if(typeof e>"u")throw new Error("Unsupported source.");return e},B=t=>{L.set(t.source,t)},rt=t=>{let{converter:e,requester:r,parser:o}=et(t);return async s=>{let n=typeof e=="function"?await e(s):s,a=await r(n);return{...await o(a),codePoint:n,source:t}}};var _t=({source:t,format:e,options:r})=>{let o=tt(r),i=rt(t),s=Z(e);return async a=>{let c=Y(a),l=await i(c);return s(l,o)}};var W={};P(W,{animator:()=>bt,format:()=>yt});var f="http://www.w3.org/2000/svg",ot="image/svg+xml";var y=t=>{let e=document.createElementNS(f,"path");return e.setAttributeNS(null,"d",t),Math.ceil(e.getTotalLength())};var nt=t=>{let e=document.createElementNS(f,"svg");e.setAttributeNS(null,"transform",t);let r=e.transform.baseVal.consolidate();if(r===null)throw new Error("Cannot get svg transform.");return r.matrix};var F=t=>{let[e,r,o,i]=t.split(" ").map(s=>parseInt(s,10));return{minX:e,minY:r,width:o,height:i}};var yt="canvas-2d",wt=t=>{let{a:e,b:r,c:o,d:i,e:s,f:n}=nt(t);return a=>{a.transform(e,r,o,i,s,n)}},st=(t,e)=>{t.save(),t.lineWidth=e.width,t.strokeStyle=e.color,t.beginPath(),t.moveTo(e.line.startPoint.x,e.line.startPoint.y),t.lineTo(e.line.endPoint.x,e.line.endPoint.y),t.stroke(),t.restore()},vt=(t,e)=>{if(!e.includeGrid)return;let{width:r,height:o}=t.canvas;for(let i=1;i<e.gridColumns;i+=1){let s=r*(i/e.gridColumns);st(t,{line:{startPoint:{x:s,y:0},endPoint:{x:s,y:o}},width:Math.ceil(r/100),color:e.gridColor})}for(let i=1;i<e.gridRows;i+=1){let s=o*(i/e.gridRows);st(t,{line:{startPoint:{x:0,y:s},endPoint:{x:r,y:s}},width:Math.ceil(o/100),color:e.gridColor})}},Ct=(t,e)=>{let{includeBackground:r,backgroundColor:o}=e;t.save(),r?(t.fillStyle=o,t.fillRect(0,0,t.canvas.width,t.canvas.height)):t.clearRect(0,0,t.canvas.width,t.canvas.height),t.restore(),vt(t,e)},V=(t,e,r)=>{t.save();let{clipPath:o,strokePath:i,strokeWidth:s,strokePathLength:n,parsedViewBox:a,strokeColor:c,contextTransform:l}=e;t.scale(t.canvas.width/a.width,t.canvas.height/a.height),l!==null&&l(t),t.fillStyle="none",t.strokeStyle=c,t.lineCap="round",t.lineJoin="round",t.lineWidth=s,t.setLineDash([n*r,n*(1-r)]),o!==null&&t.clip(o),t.stroke(i),t.restore()},bt=(t,e)=>{let{strokes:r,transform:o,viewBox:i}=t,{strokeColor:s,pauseRatio:n,totalStrokeDuration:a}=e,c=F(i),l=o===null?null:wt(o),u=r.map(b=>{let{clipPath:S,strokePath:O,strokeWidth:N}=b,mt=y(O);return{clipPath:S===null?null:new Path2D(S),strokePath:new Path2D(O),strokeWidth:N,strokePathLength:mt,parsedViewBox:c,strokeColor:s,contextTransform:l}}),m=document.createElement("canvas");m.width=c.width,m.height=c.height;let d=m.getContext("2d");if(d===null)throw new Error("Cannot get 2d context from canvas.");let g=!1,p=null,h=0,k=!1,w=a*1e3,v=r.length,C=w*v,U=b=>{if(g)return;(p===null||k)&&(p=b),h+=b-p,h>C&&(h=0),Ct(d,e);let S=Math.trunc(h/w);e.includePreview&&u.forEach(N=>{V(d,{...N,strokeColor:e.previewColor},1)}),u.slice(0,S).forEach(N=>{V(d,N,1)});let O=Math.min(1,h%w/w/(1-n));V(d,u[S],O),p=b,window.requestAnimationFrame(U)};window.requestAnimationFrame(U);let X=()=>{k||(p=null,h=0)};document.addEventListener("visibilitychange",X);let J=new ResizeObserver(b=>{for(let S of b)S.contentBoxSize[0].inlineSize>0&&S.contentBoxSize[0].blockSize>0&&S.target instanceof HTMLCanvasElement&&(S.target.width=S.contentBoxSize[0].inlineSize,S.target.height=S.contentBoxSize[0].blockSize)});return J.observe(m),Object.freeze({element:m,dispose:()=>{g=!0,document.removeEventListener("visibilitychange",X),J.disconnect()},isPaused:()=>k,pause:()=>{k=!0},resume:()=>{k=!1}})};var I={};P(I,{animator:()=>Nt,format:()=>xt});var it=0,E=()=>(it+=1,`timestamp${Math.floor(performance.timeOrigin+performance.now())}counter${it}`);var Pt=(t,e)=>{let{includeBackground:r,backgroundColor:o}=t;if(!r)return null;let i=document.createElementNS(f,"g"),s=document.createElementNS(f,"rect");return s.setAttributeNS(null,"width",e.width.toString()),s.setAttributeNS(null,"height",e.height.toString()),s.setAttributeNS(null,"fill",o),i.append(s),i},at=(t,e)=>{let r=document.createElementNS(f,"line");return r.setAttributeNS(null,"x1",t.startPoint.x.toString()),r.setAttributeNS(null,"y1",t.startPoint.y.toString()),r.setAttributeNS(null,"x2",t.endPoint.x.toString()),r.setAttributeNS(null,"y2",t.endPoint.y.toString()),r.setAttributeNS(null,"stroke",e),r.setAttributeNS(null,"stroke-width","1%"),r},At=(t,e)=>{if(!t.includeGrid)return null;let r=document.createElementNS(f,"g"),{width:o,height:i}=e;for(let s=1;s<t.gridColumns;s+=1){let n=o*(s/t.gridColumns),a={startPoint:{x:n,y:0},endPoint:{x:n,y:i}};r.append(at(a,t.gridColor))}for(let s=1;s<t.gridRows;s+=1){let n=i*(s/t.gridRows),a={startPoint:{x:0,y:n},endPoint:{x:o,y:n}};r.append(at(a,t.gridColor))}return r},lt=t=>{let{character:e,strokeColor:r,uniqueId:o,isStatic:i}=t,s=[];for(let n=0;n<e.strokes.length;n+=1){let a=e.strokes[n],c=document.createElementNS(f,"path");c.setAttributeNS(null,"d",a.strokePath);let l=null,u=null;if(a.clipPath!==null){let m=["clipPath",...i?["static"]:[],n.toString(),o].join("-");l=document.createElementNS(f,"clipPath"),l.setAttributeNS(null,"id",m),c.setAttributeNS(null,"clip-path",`url(#${m})`),u=document.createElementNS(f,"path"),u.setAttributeNS(null,"d",a.clipPath),l.append(u)}c.setAttributeNS(null,"fill","none"),c.setAttributeNS(null,"stroke",r),c.setAttributeNS(null,"stroke-linecap","round"),c.setAttributeNS(null,"stroke-linejoin","round"),i&&c.setAttributeNS(null,"stroke-width",a.strokeWidth.toString()),s.push({clipPath:l,clipPathPath:u,strokePath:c})}return s},Et=(t,e,r)=>{if(!e.includePreview)return null;let o=document.createElementNS(f,"g");return lt({character:t,strokeColor:e.previewColor,uniqueId:r,isStatic:!0}).forEach(({clipPath:s,strokePath:n})=>{s!==null&&o.append(s),o.append(n)}),o},x=(t,e,r)=>{let o=document.createElementNS(f,"svg");o.setAttribute("xmlns",f),o.setAttributeNS(null,"viewBox",t.viewBox);let i=F(t.viewBox),s=Pt(e,i);s!==null&&o.append(s);let n=At(e,i);n!==null&&o.append(n);let a=document.createElementNS(f,"g");t.transform!==null&&a.setAttributeNS(null,"transform",t.transform),o.append(a);let c=Et(t,e,r);c!==null&&a.append(c);let l=lt({character:t,strokeColor:e.strokeColor,uniqueId:r,isStatic:!1});return l.forEach(({clipPath:u,strokePath:m})=>{u!==null&&a.append(u),a.append(m)}),{svg:o,group:a,strokesComponents:l}},R=t=>{for(;t.lastChild!==null;)t.removeChild(t.lastChild);for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name)};var xt="svg-css",ct=t=>t instanceof CSSKeyframesRule,Rt=(t,e,r)=>{let{strokes:o}=t,{pauseRatio:i,totalStrokeDuration:s}=r,n=Math.min(o.length,e.length),a=document.createElementNS(f,"style"),c=s*n,l=new CSSStyleSheet;for(let u=0;u<n;u+=1){let{strokePath:m,strokeWidth:d}=o[u],g=y(m),p=e[u],h=u/n*100,k=(u+(1-i))/n*100,w=u*s,v=l.cssRules[l.insertRule(`@keyframes dash-${p} {}`,l.cssRules.length)];if(!ct(v))throw new TypeError("keyframesDash must be a CSSKeyframesRule.");w>0&&v.appendRule(`0% { stroke-dasharray: 0 ${g}; }`),v.appendRule(`${h}% { stroke-dasharray: 0 ${g}; animation-timing-function: linear; }`),k<100&&v.appendRule(`${k}% { stroke-dasharray: ${g} 0; }`),v.appendRule(`100% { stroke-dasharray: ${g} 0; }`);let C=l.cssRules[l.insertRule(`@keyframes width-${p} {}`,l.cssRules.length)];if(!ct(C))throw new TypeError("keyframesWidth must be a CSSKeyframesRule.");w>0&&C.appendRule("0% { stroke-width: 0; animation-timing-function: steps(1, end); }"),C.appendRule(`${h}% { stroke-width: ${d}; }`),k<100&&C.appendRule(`${k}% { stroke-width: ${d}; }`),C.appendRule(`100% { stroke-width: ${d}; }`),l.insertRule(`#${p} { animation: dash-${p} ${c}s infinite, width-${p} ${c}s infinite; }`,l.cssRules.length)}return a.append(Array.from(l.cssRules).map(u=>u.cssText).join(`
`)),a},Nt=(t,e)=>{let r=E(),{svg:o,group:i,strokesComponents:s}=x(t,e,r),n=[],a=[];for(let l=0;l<t.strokes.length;l+=1){let u=s[l],m=`strokePath-${l}-${r}`;n.push(m),u.strokePath.setAttributeNS(null,"id",m),a.push(u.strokePath)}let c=Rt(t,n,e);return i.append(c),Object.freeze({element:o,dispose:()=>{R(o)},isPaused:()=>a.every(l=>l.style.animationPlayState==="paused"),pause:()=>{a.forEach(l=>{l.style.animationPlayState="paused"})},resume:()=>{a.forEach(l=>{l.style.animationPlayState="running"})}})};var G={};P(G,{animator:()=>Dt,format:()=>jt});var jt="svg-smil",Ot=(t,e,r)=>{let{strokes:o}=t,{pauseRatio:i,totalStrokeDuration:s}=e,{strokePath:n}=o[r],a=y(n),c=o.length,l=s*c,u=r/c,m=(r+(1-i))/c,d=r*s,g=[],p=[];d>0&&(g.push("0"),p.push(`0 ${a}`)),g.push(u.toString()),p.push(`0 ${a}`),m<1&&(g.push(m.toString()),p.push(`${a} 0`)),g.push("1"),p.push(`${a} 0`);let h=document.createElementNS(f,"animate");return h.setAttributeNS(null,"attributeName","stroke-dasharray"),h.setAttributeNS(null,"repeatCount","indefinite"),h.setAttributeNS(null,"dur",l.toString()),h.setAttributeNS(null,"calcMode","linear"),h.setAttributeNS(null,"keyTimes",g.join(";")),h.setAttributeNS(null,"values",p.join(";")),h},$t=(t,e,r)=>{let{strokes:o}=t,{pauseRatio:i,totalStrokeDuration:s}=e,n=o.length,{strokeWidth:a}=o[r],c=s*n,l=r/n,u=(r+(1-i))/n,m=r*s,d=[],g=[];m>0&&(d.push("0"),g.push("0")),d.push(l.toString()),g.push(a.toString()),u<1&&(d.push(u.toString()),g.push(a.toString())),d.push("1"),g.push(a.toString());let p=document.createElementNS(f,"animate");return p.setAttributeNS(null,"attributeName","stroke-width"),p.setAttributeNS(null,"repeatCount","indefinite"),p.setAttributeNS(null,"dur",c.toString()),p.setAttributeNS(null,"calcMode","discrete"),p.setAttributeNS(null,"keyTimes",d.join(";")),p.setAttributeNS(null,"values",g.join(";")),p},Dt=(t,e)=>{let r=E(),{svg:o,strokesComponents:i}=x(t,e,r);for(let s=0;s<t.strokes.length;s+=1){let n=i[s];n.strokePath.append(Ot(t,e,s)),n.strokePath.append($t(t,e,s))}return Object.freeze({element:o,dispose:()=>{R(o)},isPaused:()=>o.animationsPaused(),pause:()=>{o.pauseAnimations()},resume:()=>{o.unpauseAnimations()}})};var H={};P(H,{animator:()=>Tt,format:()=>Bt});var Bt="svg-wa",Ft=(t,e,r)=>{let o=[],i=[],{strokes:s}=t,{pauseRatio:n,totalStrokeDuration:a}=e,c=s.length,l=a*c,{strokePath:u,strokeWidth:m}=s[r],d=y(u),g=r/c,p=(r+(1-n))/c;r*a>0&&(o.push({offset:0,strokeDasharray:`0 ${d}`}),i.push({offset:0,strokeWidth:"0",easing:"steps(1, end)"})),o.push({offset:g,strokeDasharray:`0 ${d}`,easing:"linear"}),i.push({offset:g,strokeWidth:`${m}`}),p<1&&(o.push({offset:p,strokeDasharray:`${d} 0`}),i.push({offset:p,strokeWidth:`${m}`})),o.push({offset:1,strokeDasharray:`${d} 0`}),i.push({offset:1,strokeWidth:`${m}`});let k={duration:l*1e3,iterations:1/0};return{dashKeyframes:o,widthKeyframes:i,keyframeOptions:k}},Tt=(t,e)=>{let r=E(),{svg:o,strokesComponents:i}=x(t,e,r),s=[];for(let n=0;n<t.strokes.length;n+=1){let a=i[n],{dashKeyframes:c,widthKeyframes:l,keyframeOptions:u}=Ft(t,e,n),m=a.strokePath.animate(c,u);s.push(m);let d=a.strokePath.animate(l,u);s.push(d)}return Object.freeze({element:o,dispose:()=>{s.forEach(n=>{n.cancel()}),R(o)},isPaused:()=>s.every(n=>n.playState==="paused"),pause:()=>{s.forEach(n=>{n.pause()})},resume:()=>{s.forEach(n=>{n.play()})}})};var q={};P(q,{parser:()=>Lt,requester:()=>zt,source:()=>Mt});var ut=t=>{let e=/[-]?\d+(?:\.\d+)?/gu;return t.match(e)?.map(r=>parseFloat(r))??[]};var T=async t=>{let e=await fetch(t,{cache:"no-store"});if(!e.ok)throw new Error(`Unexpected HTTP response status code ${e.status}.`);return e};var Mt="ja-kanjivg",zt=async t=>{let o=`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${`${t.toString(16).padStart(5,"0")}.svg`}`;return await T(o)},Lt=async t=>{let e=await t.text(),r=new DOMParser().parseFromString(e,ot),o=r.querySelector("svg")?.getAttribute("viewBox");if(o===null||typeof o>"u")throw new Error("Cannot get viewBox.");let i=Array.from(r.querySelectorAll("g[style]")).map(n=>parseFloat(n.style.getPropertyValue("stroke-width"))).find(n=>!isNaN(n)&&isFinite(n));if(typeof i>"u")throw new Error("Cannot get strokeWidth.");return{strokes:Array.from(r.querySelectorAll("path")).sort((n,a)=>{let[c,l]=[n,a].map(u=>{let m=u.getAttribute("id");if(m===null)throw new Error("Cannot get id.");return ut(m)[1]});return c-l}).map(n=>{let a=n.getAttribute("d");if(a===null)throw new Error("Cannot get d.");return a}).map(n=>({clipPath:null,strokePath:n,strokeWidth:i})),transform:null,viewBox:o}};var K={};P(K,{parser:()=>Gt,requester:()=>It,source:()=>Vt});var Vt="zh-hanziwriter",Wt=t=>typeof t=="object"&&t!==null&&"strokes"in t&&"medians"in t,It=async t=>{let r=`https://cdn.jsdelivr.net/npm/hanzi-writer-data/${String.fromCodePoint(t)}.json`;return await T(r)},Gt=async t=>{let e=await t.json();if(!Wt(e))throw new Error("Data is invalid.");let r=128,o=[];for(let i=0;i<Math.min(e.strokes.length,e.medians.length);i+=1){let s=e.medians[i].map((n,a)=>[a===0?"M":"L",n[0].toString(),n[1].toString()].join(" ")).join(" ");o.push({clipPath:e.strokes[i],strokePath:s,strokeWidth:r})}return{strokes:o,transform:"scale(1, -1) translate(0, -900)",viewBox:"0 0 1024 1024"}};B({...q,source:"ja"});B({...K,source:"zh"});A(W);A(I);A(G);A(H);export{Q as getFormatComponents,dt as getFormats,tt as getFullOptions,et as getSourceComponents,kt as getSources,A as registerFormat,B as registerSource,_t as strokes};
