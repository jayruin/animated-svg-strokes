var k=0,f=()=>(k+=1,`timestamp${Math.floor(performance.timeOrigin+performance.now())}counter${k}`);var a="http://www.w3.org/2000/svg";var A=t=>{let[r,n,o,l]=t.split(" ").map(e=>parseInt(e,10));return{minX:r,minY:n,width:o,height:l}};var P=(t,r)=>{let{includeBackground:n,backgroundColor:o}=t;if(!n)return null;let l=document.createElementNS(a,"g"),e=document.createElementNS(a,"rect");return e.setAttributeNS(null,"width",r.width.toString()),e.setAttributeNS(null,"height",r.height.toString()),e.setAttributeNS(null,"fill",o),l.append(e),l},N=(t,r)=>{let n=document.createElementNS(a,"line");return n.setAttributeNS(null,"x1",t.startPoint.x.toString()),n.setAttributeNS(null,"y1",t.startPoint.y.toString()),n.setAttributeNS(null,"x2",t.endPoint.x.toString()),n.setAttributeNS(null,"y2",t.endPoint.y.toString()),n.setAttributeNS(null,"stroke",r),n.setAttributeNS(null,"stroke-width","1%"),n},x=(t,r)=>{if(!t.includeGrid)return null;let n=document.createElementNS(a,"g"),{width:o,height:l}=r;for(let e=1;e<t.gridColumns;e+=1){let s=o*(e/t.gridColumns),i={startPoint:{x:s,y:0},endPoint:{x:s,y:l}};n.append(N(i,t.gridColor))}for(let e=1;e<t.gridRows;e+=1){let s=l*(e/t.gridRows),i={startPoint:{x:0,y:s},endPoint:{x:o,y:s}};n.append(N(i,t.gridColor))}return n},v=t=>{let{character:r,strokeColor:n,uniqueId:o,isStatic:l}=t,e=[];for(let s=0;s<r.strokes.length;s+=1){let i=r.strokes[s],u=document.createElementNS(a,"path");u.setAttributeNS(null,"d",i.strokePath);let p=null,m=null;if(i.clipPath!==null){let g=["clipPath",...l?["static"]:[],s.toString(),o].join("-");p=document.createElementNS(a,"clipPath"),p.setAttributeNS(null,"id",g),u.setAttributeNS(null,"clip-path",`url(#${g})`),m=document.createElementNS(a,"path"),m.setAttributeNS(null,"d",i.clipPath),p.append(m)}u.setAttributeNS(null,"fill","none"),u.setAttributeNS(null,"stroke",n),u.setAttributeNS(null,"stroke-linecap","round"),u.setAttributeNS(null,"stroke-linejoin","round"),l&&u.setAttributeNS(null,"stroke-width",i.strokeWidth.toString()),e.push({clipPath:p,clipPathPath:m,strokePath:u})}return e},y=(t,r,n)=>{if(!r.includePreview)return null;let o=document.createElementNS(a,"g");return v({character:t,strokeColor:r.previewColor,uniqueId:n,isStatic:!0}).forEach(({clipPath:e,strokePath:s})=>{e!==null&&o.append(e),o.append(s)}),o},b=(t,r,n)=>{let o=document.createElementNS(a,"svg");o.setAttribute("xmlns",a),o.setAttributeNS(null,"viewBox",t.viewBox);let l=A(t.viewBox),e=P(r,l);e!==null&&o.append(e);let s=x(r,l);s!==null&&o.append(s);let i=document.createElementNS(a,"g");t.transform!==null&&i.setAttributeNS(null,"transform",t.transform),o.append(i);let u=y(t,r,n);u!==null&&i.append(u);let p=v({character:t,strokeColor:r.strokeColor,uniqueId:n,isStatic:!1});return p.forEach(({clipPath:m,strokePath:g})=>{m!==null&&i.append(m),i.append(g)}),{svg:o,group:i,strokesComponents:p}},C=t=>{for(;t.lastChild!==null;)t.removeChild(t.lastChild);for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name)};var w=t=>{let r=document.createElementNS(a,"path");return r.setAttributeNS(null,"d",t),Math.ceil(r.getTotalLength())};var W="svg-smil",E=(t,r,n)=>{let{strokes:o}=t,{pauseRatio:l,totalStrokeDuration:e}=r,{strokePath:s}=o[n],i=w(s),u=o.length,p=e*u,m=n/u,g=(n+(1-l))/u,d=n*e,S=[],c=[];d>0&&(S.push("0"),c.push(`0 ${i}`)),S.push(m.toString()),c.push(`0 ${i}`),g<1&&(S.push(g.toString()),c.push(`${i} 0`)),S.push("1"),c.push(`${i} 0`);let h=document.createElementNS(a,"animate");return h.setAttributeNS(null,"attributeName","stroke-dasharray"),h.setAttributeNS(null,"repeatCount","indefinite"),h.setAttributeNS(null,"dur",p.toString()),h.setAttributeNS(null,"calcMode","linear"),h.setAttributeNS(null,"keyTimes",S.join(";")),h.setAttributeNS(null,"values",c.join(";")),h},B=(t,r,n)=>{let{strokes:o}=t,{pauseRatio:l,totalStrokeDuration:e}=r,s=o.length,{strokeWidth:i}=o[n],u=e*s,p=n/s,m=(n+(1-l))/s,g=n*e,d=[],S=[];g>0&&(d.push("0"),S.push("0")),d.push(p.toString()),S.push(i.toString()),m<1&&(d.push(m.toString()),S.push(i.toString())),d.push("1"),S.push(i.toString());let c=document.createElementNS(a,"animate");return c.setAttributeNS(null,"attributeName","stroke-width"),c.setAttributeNS(null,"repeatCount","indefinite"),c.setAttributeNS(null,"dur",u.toString()),c.setAttributeNS(null,"calcMode","discrete"),c.setAttributeNS(null,"keyTimes",d.join(";")),c.setAttributeNS(null,"values",S.join(";")),c},U=(t,r)=>{let n=f(),{svg:o,strokesComponents:l}=b(t,r,n);for(let e=0;e<t.strokes.length;e+=1){let s=l[e];s.strokePath.append(E(t,r,e)),s.strokePath.append(B(t,r,e))}return Object.freeze({element:o,dispose:()=>{C(o)},isPaused:()=>o.animationsPaused(),pause:()=>{o.pauseAnimations()},resume:()=>{o.unpauseAnimations()}})};export{U as animator,W as format};
